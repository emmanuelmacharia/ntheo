name: CI

on: [push]

jobs: 
    build: 
        runs-on: ubuntu-latest
        steps: 
            - name: Checkout
              uses: actions/checkout@v2

            - name: Install dependencies
              run: npm install -g pnpm && pnpm install

            - name: Copy .env.example files
              shell: bash
              run: |
                set -euo pipefail
                while IFS= read -r file; do
                    target="${file%.example}"
                    if [[ ! -e "$target" ]]; then
                    cp "$file" "$target"
                    fi
                done < <(git ls-files -co --exclude-standard '*.env.example')

            - name: Typecheck
              run: pnpm run typecheck

            - name: Lint
              run: pnpm run lint

            